{% extends "admin_home/base.html" %}
{% load static %}

{% block content %}
<style>
  .add-category-container {
    max-width: 800px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .header-left h2 {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 8px;
  }

  .header-left p {
    color: #6c757d;
    font-size: 14px;
    margin: 0;
  }

  .btn-back {
    padding: 12px 24px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
  }

  .btn-back:hover {
    background: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
  }

  .category-form-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }

  .category-form-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 25px 30px;
    color: white;
  }

  .category-form-header h3 {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .category-form-body {
    padding: 30px;
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
  }

  .form-label .required {
    color: #e74c3c;
    margin-left: 4px;
  }

  .form-control {
    width: 100%;
    padding: 12px 16px;
    font-size: 14px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    transition: all 0.3s ease;
    background: #f8f9fa;
    box-sizing: border-box;
    font-family: inherit;
  }

  .form-control:focus {
    outline: none;
    border-color: #3498db;
    background: #fff;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
  }

  .form-control:read-only {
    background: #e9ecef;
    border-color: #ced4da;
    color: #6c757d;
    cursor: not-allowed;
  }

  .form-control:read-only:focus {
    border-color: #ced4da;
    box-shadow: none;
  }

  .character-count {
    font-size: 12px;
    color: #6c757d;
    margin-top: 6px;
    text-align: right;
  }

  .character-count.warning {
    color: #e67e22;
  }

  .character-count.error {
    color: #e74c3c;
    font-weight: 600;
  }

  .error-message {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 6px;
    display: none;
  }

  .error-message.show {
    display: block;
  }

  .slug-info {
    background: #e3f2fd;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    border-left: 4px solid #3498db;
  }

  .slug-info h5 {
    font-size: 14px;
    font-weight: 600;
    color: #2c3e50;
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .slug-info p {
    font-size: 12px;
    color: #6c757d;
    margin: 0;
  }

  .form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
  }

  .btn-form {
    flex: 1;
    padding: 14px 24px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-cancel {
    background: #e9ecef;
    color: #495057;
    text-decoration: none;
    text-align: center;
  }

  .btn-cancel:hover {
    background: #dee2e6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.2);
  }

  .btn-submit {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
  }

  .btn-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
  }

  .btn-submit:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .slug-preview {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  }

  .slug-preview-label {
    font-size: 12px;
    font-weight: 600;
    color: #6c757d;
  }

  .slug-preview-value {
    font-size: 13px;
    font-family: monospace;
    color: #2c3e50;
    background: white;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #e9ecef;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .add-category-container {
      margin: 0 15px;
    }

    .page-header {
      flex-direction: column;
      align-items: stretch;
    }

    .category-form-body {
      padding: 20px;
    }

    .form-actions {
      flex-direction: column;
    }

    .btn-form {
      width: 100%;
    }
  }

  @media (max-width: 576px) {
    .header-left h2 {
      font-size: 20px;
    }

    .category-form-header {
      padding: 20px;
    }

    .category-form-header h3 {
      font-size: 16px;
    }
  }
</style>

<div class="add-category-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h2>Add Category</h2>
      <p>Create a new category to organize your content</p>
    </div>
    <a href="{% url 'view_category' %}" class="btn-back">
      <i class="mdi mdi-arrow-left"></i>
      Back to Categories
    </a>
  </div>

  <!-- Category Form Card -->
  <div class="category-form-card">
    <div class="category-form-header">
      <h3>
        <i class="mdi mdi-tag-plus"></i>
        Category Information
      </h3>
    </div>

    <div class="category-form-body">
      <form method="POST" id="categoryForm">
        {% csrf_token %}
        
        <div class="form-group">
          <label class="form-label">
            Category Name<span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-control" 
            name="name" 
            id="categoryName" 
            placeholder="Enter category name (e.g., Web Development, Design, Marketing)"
            required
            maxlength="50"
            autofocus
          >
          <div class="error-message" id="nameError">Please enter a valid category name</div>
          <div class="character-count" id="nameCount">0/50 characters</div>
        </div>

        <div class="form-group">
          <label class="form-label">
            Category Slug
          </label>
          <input 
            type="text" 
            class="form-control" 
            name="slug" 
            id="categorySlug" 
            placeholder="Auto-generated slug will appear here"
            readonly
            maxlength="60"
            hidden
          >
          <div class="slug-preview">
            <span class="slug-preview-label">Preview URL:</span>
            <span class="slug-preview-value" id="slugPreview">your-site.com/category/</span>
          </div>
          <div class="character-count" id="slugCount">0/60 characters</div>
        </div>

        <div class="slug-info">
          <h5>
            <i class="mdi mdi-information"></i>
            About Category Slugs
          </h5>
          <p>Slugs are auto-generated from the category name and are used in URLs. They should be lowercase, contain only letters, numbers, and hyphens. The slug will be automatically created as you type the category name.</p>
        </div>

        <div class="form-actions">
          <a href="{% url 'view_category' %}" class="btn-form btn-cancel">
            <i class="mdi mdi-close"></i>
            Cancel
          </a>
          <button type="submit" class="btn-form btn-submit" id="submitBtn">
            <i class="mdi mdi-check"></i>
            Create Category
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Form elements
    const form = document.getElementById('categoryForm');
    const categoryName = document.getElementById('categoryName');
    const categorySlug = document.getElementById('categorySlug');
    const slugPreview = document.getElementById('slugPreview');
    const submitBtn = document.getElementById('submitBtn');
    const nameCount = document.getElementById('nameCount');
    const slugCount = document.getElementById('slugCount');
    const nameError = document.getElementById('nameError');

    // Initialize character counts
    updateCharacterCount(categoryName, nameCount, 50);
    updateCharacterCount(categorySlug, slugCount, 60);

    // Character count functionality
    function updateCharacterCount(element, countElement, maxLength) {
      const currentLength = element.value.length;
      countElement.textContent = `${currentLength}/${maxLength} characters`;
      
      if (currentLength > maxLength * 0.9) {
        countElement.classList.add('warning');
        countElement.classList.remove('error');
      } else if (currentLength > maxLength) {
        countElement.classList.add('error');
        countElement.classList.remove('warning');
      } else {
        countElement.classList.remove('warning', 'error');
      }
    }

    // Slug generation functionality
    function generateSlug(text) {
      return text
        .toLowerCase()
        .trim()
        .replace(/[^\w\s-]/g, '') // Remove special characters
        .replace(/[\s_-]+/g, '-') // Replace spaces and underscores with hyphens
        .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens
    }

    // Event listener for category name input
    categoryName.addEventListener('input', function() {
      const name = this.value.trim();
      
      // Update character count
      updateCharacterCount(this, nameCount, 50);
      
      // Generate and set slug
      if (name) {
        const slug = generateSlug(name);
        categorySlug.value = slug;
        slugPreview.textContent = `your-site.com/category/${slug}`;
        
        // Update slug character count
        updateCharacterCount(categorySlug, slugCount, 60);
      } else {
        categorySlug.value = '';
        slugPreview.textContent = 'your-site.com/category/';
        updateCharacterCount(categorySlug, slugCount, 60);
      }
      
      // Validate field
      validateField(this, nameError, 'name');
    });

    // Manual slug editing (if needed)
    categorySlug.addEventListener('focus', function() {
      // Remove readonly temporarily for manual editing
      this.removeAttribute('readonly');
    });

    categorySlug.addEventListener('blur', function() {
      // Clean up and validate the manually entered slug
      const manualSlug = generateSlug(this.value);
      this.value = manualSlug;
      slugPreview.textContent = `your-site.com/category/${manualSlug}`;
      updateCharacterCount(this, slugCount, 60);
      
      // Set back to readonly if empty
      if (!this.value) {
        this.setAttribute('readonly', 'true');
      }
    });

    // Field validation
    function validateField(field, errorElement, fieldType) {
      const value = field.value.trim();
      
      if (!value) {
        showError(field, errorElement, 'This field is required');
        return false;
      }
      
      if (fieldType === 'name' && value.length > 50) {
        showError(field, errorElement, 'Category name must be 50 characters or less');
        return false;
      }
      
      if (fieldType === 'slug' && value.length > 60) {
        showError(field, errorElement, 'Slug must be 60 characters or less');
        return false;
      }
      
      hideError(field, errorElement);
      return true;
    }

    function showError(field, errorElement, message) {
      field.classList.add('error');
      errorElement.textContent = message;
      errorElement.classList.add('show');
    }

    function hideError(field, errorElement) {
      field.classList.remove('error');
      errorElement.classList.remove('show');
    }

    // Form submission validation
    form.addEventListener('submit', function(e) {
      let isValid = true;
      
      // Validate category name
      if (!validateField(categoryName, nameError, 'name')) {
        isValid = false;
      }
      
      // Additional validation for slug
      const slug = categorySlug.value.trim();
      if (!slug) {
        showError(categorySlug, document.getElementById('slugError'), 'Slug is required');
        isValid = false;
      } else if (slug.length > 60) {
        showError(categorySlug, document.getElementById('slugError'), 'Slug must be 60 characters or less');
        isValid = false;
      } else if (!/^[a-z0-9-]+$/.test(slug)) {
        showError(categorySlug, document.getElementById('slugError'), 'Slug can only contain lowercase letters, numbers, and hyphens');
        isValid = false;
      }
      
      if (!isValid) {
        e.preventDefault();
        // Scroll to first error
        const firstError = form.querySelector('.error');
        if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    });

    // Real-time validation on blur
    categoryName.addEventListener('blur', function() {
      validateField(this, nameError, 'name');
    });

    // Initialize with empty state
    updateCharacterCount(categorySlug, slugCount, 60);
  });
</script>
{% endblock %}